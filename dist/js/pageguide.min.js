/*! pageguide 2014-02-06 */
tl=window.tl||{},tl.pg=tl.pg||{},tl.pg.interval={},function(a){tl.pg.default_prefs={auto_show_first:!0,loading_selector:"#loading",track_events_cb:function(){},handle_doc_switch:null,custom_open_button:null,pg_caption:"page guide",tourtitle:"Open Page Guide for help",check_welcome_dismissed:function(){var a="tlypageguide_welcome_shown_"+tl.pg.hashUrl();try{if(localStorage.getItem(a))return!0}catch(b){if(document.cookie.indexOf(a)>-1)return!0}return!1},dismiss_welcome:function(){var a="tlypageguide_welcome_shown_"+tl.pg.hashUrl();try{localStorage.setItem(a,!0)}catch(b){var c=new Date;c.setDate(c.getDate()+365),document.cookie=a+"=true; expires="+c.toUTCString()}},ready_callback:null,pointer_fallback:!0,default_zindex:100,steps_element:"#tlyPageGuide"},tl.pg.wrapper_markup='<div id="tlyPageGuideWrapper"><div id="tlyPageGuideMessages"><a href="#" class="tlypageguide_close" title="Close Guide">close</a><span class="tlypageguide_index"></span><div class="tlypageguide_text"></div><a href="#" class="tlypageguide_back" title="Previous">Previous</a><a href="#" class="tlypageguide_fwd" title="Next">Next</a></div><div id="tlyPageGuideContent"></div><div id="tlyPageGuideToggles"></div></div>',tl.pg.toggle_markup='<div class="tlypageguide_toggle" title="Launch Page Guide"><div><span class="tlypageguide_toggletitle"></span></div><a href="#" class="tlypageguide_close" title="close guide">close guide &raquo;</a></div>',tl.pg.init=function(b){b=a.extend({},tl.pg.default_prefs,b);var c=a(b.steps_element),d=tl.pg.hashCode(b.steps_element);if(clearInterval(tl.pg.interval[d]),0!==c.length){b.pointer_fallback&&tl.pg.pointerEventSupport()&&(b.pointer_fallback=!1);var e=a("#tlyPageGuideWrapper"),f=!0;if(e.length||(f=!1,e=a(tl.pg.wrapper_markup)),null==b.custom_open_button&&a("#tlyPageGuideToggle"+d).length<1){var g=c.data("tourtitle")||b.tourtitle,h=a(tl.pg.toggle_markup).attr("id","tlyPageGuideToggle"+d).prepend(b.pg_caption);h.find(".tlypageguide_toggletitle").text(g),e.find("#tlyPageGuideToggles").append(h)}f||a("body").prepend(e);var i=new tl.pg.PageGuide(a("#tlyPageGuideWrapper"),b);return i.ready(function(){i.setup_welcome(),i.setup_handlers(),i.$base.find(".tlypageguide_toggle").animate({right:"-120px"},250),"function"==typeof b.ready_callback&&b.ready_callback()}),i}},tl.pg.PageGuide=function(b,c){this.preferences=c,this.$base=b,this.$message=this.$base.find("#tlyPageGuideMessages"),this.$fwd=this.$base.find("a.tlypageguide_fwd"),this.$back=this.$base.find("a.tlypageguide_back"),this.$content=this.$base.find("#tlyPageGuideContent"),this.$welcome=a("#tlyPageGuideWelcome"),this.$steps=a(c.steps_element),this.uuid=tl.pg.hashCode(c.steps_element),this.$toggle=this.$base.find("#tlyPageGuideToggle"+this.uuid),this.cur_idx=0,this.cur_selector=null,this.track_event=this.preferences.track_events_cb,this.handle_doc_switch=this.preferences.handle_doc_switch,this.custom_open_button=this.preferences.custom_open_button,this.is_open=!1,this.targetData={},this.hashTable={},this.changeQueue=[],this.visibleTargets=[]},tl.pg.hashUrl=function(){return tl.pg.hashCode(window.location.href)},tl.pg.hashCode=function(a){var b,c,d=0;if(null==a||0===a.length)return d;for(b=0;b<a.length;b++)c=a.charCodeAt(b),d=(d<<5)-d+c,d&=d;return d.toString()},tl.pg.isScrolledIntoView=function(b){var c=a(window).scrollTop(),d=c+a(window).height(),e=a(b).offset().top,f=e+a(b).height();return f>=c&&d-100>=e},tl.pg.destroy=function(){a("#tlyPageGuideWrapper").remove(),a("#tlyPageGuideOverlay").remove(),a("body").removeClass("tlypageguide-open"),a("body").removeClass("tlyPageGuideWelcomeOpen");for(var b in tl.pg.interval)tl.pg.interval.hasOwnProperty(b)&&clearInterval(tl.pg.interval[b])},tl.pg.pointerEventSupport=function(){var a=document.createElement("x"),b=document.documentElement,c=window.getComputedStyle,d=null;return"pointerEvents"in a.style?(a.style.pointerEvents="auto",a.style.pointerEvents="x",b.appendChild(a),d=c&&"auto"===c(a,"").pointerEvents,b.removeChild(a),!!d):!1},tl.pg.PageGuide.prototype.setup_welcome=function(){var b=a("#tlyPageGuideWelcome"),c=this;b.length>0&&(c.preferences.show_welcome=!c.preferences.check_welcome_dismissed(),c.preferences.show_welcome&&(a("#tlyPageGuideOverlay").length||a("body").prepend('<div id="tlyPageGuideOverlay"></div>'),b.appendTo(c.$base)),b.find(".tlypageguide_ignore").length&&b.on("click",".tlypageguide_ignore",function(){c.close_welcome(),c.track_event("PG.ignoreWelcome")}),b.find(".tlypageguide_dismiss").length&&b.on("click",".tlypageguide_dismiss",function(){c.close_welcome(),c.preferences.dismiss_welcome(),c.track_event("PG.dismissWelcome")}),b.on("click",".tlypageguide_start",function(){c.open(),c.track_event("PG.startFromWelcome")}),c.preferences.show_welcome&&c.pop_welcome())},tl.pg.PageGuide.prototype.ready=function(b){var c=this;return tl.pg.interval[c.uuid]=window.setInterval(function(){a(c.preferences.loading_selector).is(":visible")||(b(),clearInterval(tl.pg.interval[c.uuid]))},250),this},tl.pg.PageGuide.prototype.addSteps=function(){var b=this;b.$steps.find("li").each(function(c,d){var e=a(d),f=e.data("tourtarget"),g=e.attr("class");if(null==b.targetData[f]){b.targetData[f]={targetStyle:{},content:e.html()};var h=tl.pg.hashCode(f)+"";b.hashTable[h]=f,b.$content.append('<div class="tlypageguide_shadow tlypageguide_shadow'+h+'" data-selectorhash="'+h+'"><span class="tlyPageGuideStepIndex '+g+'"></span></div>')}})},tl.pg.PageGuide.prototype.checkTargets=function(){var b=this,c=0,d=[];for(var e in b.targetData){var f=a(e),g={targetStyle:{display:f.length&&f.is(":visible")?"block":"none"}};if("block"===g.targetStyle.display){var h=f.offset();a.extend(g.targetStyle,{top:h.top,left:h.left,width:f.outerWidth(),height:f.outerHeight(),"z-index":f.css("z-index")}),c++,g.index=c,d.push(e)}var i={target:e};for(var j in g.targetStyle)g.targetStyle[j]!==b.targetData[e][j]&&(null==i.targetStyle&&(i.targetStyle={}),i.targetStyle[j]=g.targetStyle[j]);g.index!==b.targetData[e].index&&(i.index=g.index),(null!=i.targetStyle||null!=i.index)&&b.changeQueue.push(i),a.extend(b.targetData[e],g)}b.visibleTargets=d},tl.pg.PageGuide.prototype.positionOverlays=function(){for(var b=this,c=0;c<b.changeQueue.length;c++){var d=b.changeQueue[c],e=".tlypageguide_shadow"+tl.pg.hashCode(d.target),f=b.$content.find(e);if(null!=d.targetStyle){var g=a.extend({},d.targetStyle);for(var h in g)"z-index"===h&&(g[h]="number"==typeof g[h]?g[h]+1:b.preferences.default_zindex);f.css(g)}null!=d.index&&f.find(".tlyPageGuideStepIndex").text(d.index)}b.changeQueue=[]},tl.pg.PageGuide.prototype.refreshVisibleSteps=function(){var a=this;a.addSteps(),a.checkTargets(),a.positionOverlays()},tl.pg.PageGuide.prototype.updateVisible=function(){var a=this;if(a.refreshVisibleSteps(),null!=a.cur_selector&&a.cur_selector!==a.visibleTargets[a.cur_idx]){var b=a.cur_idx%a.visibleTargets.length;a.show_message(b)}},tl.pg.PageGuide.prototype.show_message=function(b){var c=this,d=c.visibleTargets[b],e=c.targetData[d];if(null!=e){var f=".tlypageguide_shadow"+tl.pg.hashCode(d);c.$content.find(".tlypageguide-active").removeClass("tlypageguide-active"),c.$content.find(f).addClass("tlypageguide-active"),c.$message.find(".tlypageguide_text").html(e.content),c.cur_idx=b,c.cur_selector=d;var g=100,h=parseFloat(c.$message.css("height"));c.$message.css("height","auto");var i=parseFloat(c.$message.outerHeight());c.$message.css("height",h),g>i&&(i=g),i>a(window).height()/2&&(i=a(window).height()/2),tl.pg.isScrolledIntoView(a(d))||a("html,body").animate({scrollTop:e.targetStyle.top-50},500),c.$message.show().animate({height:i},500),c.roll_number(c.$message.find("span"),e.index)}},tl.pg.PageGuide.prototype.navigateBack=function(){var a=this,b=(a.cur_idx+a.visibleTargets.length-1)%a.visibleTargets.length;return a.track_event("PG.back"),a.show_message(b,!0),!1},tl.pg.PageGuide.prototype.navigateForward=function(){var a=this,b=(a.cur_idx+1)%a.visibleTargets.length;return a.track_event("PG.fwd"),a.show_message(b,!0),!1},tl.pg.PageGuide.prototype.open=function(){this.is_open||this._open()},tl.pg.PageGuide.prototype._open=function(){this.preferences.show_welcome&&(this.preferences.dismiss_welcome(),this.close_welcome()),this.is_open=!0,this.track_event("PG.open"),this.refreshVisibleSteps(),this.preferences.auto_show_first&&this.visibleTargets.length&&this.show_message(0),a("body").addClass("tlypageguide-open"),this.$toggle.addClass("tlyPageGuideToggleActive")},tl.pg.PageGuide.prototype.close=function(){this.is_open&&this._close()},tl.pg.PageGuide.prototype._close=function(){this.is_open=!1,this.track_event("PG.close"),this.$content.find(".tlypageguide_shadow").css("display","none"),this.$content.find(".tlypageguide-active").removeClass("tlypageguide-active"),this.$message.animate({height:"0"},500,function(){a(this).hide()}),a("body").removeClass("tlypageguide-open"),this.$toggle.removeClass("tlyPageGuideToggleActive")},tl.pg.PageGuide.prototype.setup_handlers=function(){var b=this,c=null==b.custom_open_button?b.$base.find("#tlyPageGuideToggle"+b.uuid):a(b.custom_open_button);c.off(),c.on("click",function(){return b.is_open?b.close():!b.preferences.show_welcome||b.preferences.check_welcome_dismissed()||a("body").hasClass("tlyPageGuideWelcomeOpen")?b.open():b.pop_welcome(),!1}),a(".tlypageguide_close",b.$message.add(a(".tlypageguide_toggle"))).on("click",function(){return b.close(),!1}),b.$base.on("click",".tlyPageGuideStepIndex",function(){var c=b.hashTable[a(this).parent().data("selectorhash")],d=b.targetData[c],e=d?d.index:1;b.track_event("PG.specific_elt"),b.show_message(e-1)}),b.$fwd.on("click",function(){return b.is_open&&b.navigateForward(),!1}),b.$back.on("click",function(){return b.is_open&&b.navigateBack(),!1}),b.preferences.pointer_fallback&&b.$base.on("click",".tlypageguide_shadow",function(b){a(this).hide();var c=a(document.elementFromPoint(b.clientX,b.clientY));c.is("a")?c.get(0).click():c.trigger(b.type),a(this).show()}),a(window).resize(function(){b.refreshVisibleSteps()})},tl.pg.PageGuide.prototype.roll_number=function(a,b,c){a.animate({"text-indent":(c?"":"-")+"50px"},"fast",function(){a.html(b),a.css({"text-indent":(c?"-":"")+"50px"},"fast").animate({"text-indent":"0"},"fast")})},tl.pg.PageGuide.prototype.pop_welcome=function(){a("body").addClass("tlyPageGuideWelcomeOpen"),this.track_event("PG.welcomeShown")},tl.pg.PageGuide.prototype.close_welcome=function(){a("body").removeClass("tlyPageGuideWelcomeOpen")}}(jQuery);